import{q as k,u as b,j as e,s as d}from"./main-B5FlV0ud.js";import{H as q}from"./Header-DLdij8DV.js";import"./x-DfPbw0Sj.js";const y=i=>{if(!i)return"";const r=new Date(i);return Number.isNaN(r.getTime())?"":r.toLocaleDateString("pt-PT",{day:"2-digit",month:"long",year:"numeric"})},E=i=>i?i.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():"",L=i=>{const r=E(i);return r?r.length<=220?r:`${r.slice(0,220).trim()}...`:""},C=i=>i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),F={noticias:"bg-[#c6f36d] text-black",eventos:"bg-[#ffd166] text-black",cultura:"bg-[#5de2ff] text-black",literatura:"bg-[#ff8fab] text-black",opiniao:"bg-[#bdb2ff] text-black",entrevistas:"bg-[#a6ff8f] text-black",lancamentos:"bg-[#ffc6ff] text-black"},_=i=>{const r=C(i);return F[r]??"bg-[#c6f36d] text-black"},j=({title:i,children:r})=>e.jsxs("div",{className:"border border-gray-200 bg-white p-6 rounded-none",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-gray-600",children:i}),e.jsx("div",{className:"mt-4",children:r})]});function A(){const{slug:i}=k.useParams(),r=b({queryKey:["news-post",i],queryFn:async()=>{const{data:a,error:t}=await d.from("posts").select(`
          id,
          title,
          slug,
          excerpt,
          body,
          featured_image_url,
          published_at,
          created_at,
          author_id,
          view_count,
          categories:post_categories_map(category:post_categories(id, name, slug)),
          tags:post_tags_map(tag:post_tags(id, name, slug))
        `).eq("status","published").eq("slug",i).maybeSingle();if(t)throw t;if(!a)return null;const x=a.categories?.map(l=>l.category).filter(Boolean)??[],g=a.tags?.map(l=>l.tag).filter(Boolean)??[];let c=null;if(a.author_id){const{data:l,error:p}=await d.from("profiles").select("id, name, email, photo_url").eq("id",a.author_id).maybeSingle();p||(c=l)}return{...a,categories:x,tags:g,author:c}},staleTime:6e4}),n=b({queryKey:["post-tags","public"],queryFn:async()=>{const{data:a,error:t}=await d.from("post_tags").select("id, name, slug").eq("is_active",!0).order("name",{ascending:!0}).limit(12);if(t)throw t;return a??[]},staleTime:6e4}),o=b({queryKey:["news-posts","recent"],queryFn:async()=>{const{data:a,error:t}=await d.from("posts").select("id, title, slug, featured_image_url, published_at, created_at").eq("status","published").order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).limit(4);if(t)throw t;return a??[]},staleTime:6e4}),s=r.data,u=s?.categories?.map(a=>a.id)??[],h=s?.tags?.map(a=>a.id)??[],m=b({queryKey:["news-post",i,"related",u.join(","),h.join(",")],enabled:!!(s&&(u.length||h.length)),queryFn:async()=>{if(!s)return[];const a=new Set;if(u.length>0){const{data:c,error:l}=await d.from("post_categories_map").select("post_id").in("category_id",u);if(l)throw l;c?.forEach(p=>a.add(p.post_id))}if(h.length>0){const{data:c,error:l}=await d.from("post_tags_map").select("post_id").in("tag_id",h);if(l)throw l;c?.forEach(p=>a.add(p.post_id))}a.delete(s.id);const t=Array.from(a);if(t.length===0)return[];const{data:x,error:g}=await d.from("posts").select(`
          id,
          title,
          slug,
          featured_image_url,
          published_at,
          created_at,
          categories:post_categories_map(category:post_categories(name, slug))
        `).eq("status","published").in("id",t).order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).limit(3);if(g)throw g;return(x??[]).map(c=>({...c,categories:c.categories?.map(l=>l.category).filter(Boolean)??[]}))},staleTime:6e4}),f=s?.categories?.[0],N=s?.featured_image_url,v=y(s?.published_at??s?.created_at??null),w=s?.excerpt?.trim()||L(s?.body);return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(q,{}),r.isLoading&&e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"bg-[#1c1b1a] text-white",children:e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsxs("div",{className:"max-w-3xl space-y-4",children:[e.jsx("div",{className:"h-4 w-32 bg-white/30 animate-pulse"}),e.jsx("div",{className:"h-10 w-full bg-white/20 animate-pulse"}),e.jsx("div",{className:"h-4 w-1/2 bg-white/20 animate-pulse"})]})})}),e.jsx("main",{className:"py-20",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-15",children:e.jsxs("div",{className:"grid gap-12 lg:grid-cols-[1fr_320px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-4 w-1/3 bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-4 w-full bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-4 w-5/6 bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-4 w-4/6 bg-gray-200 animate-pulse"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-32 bg-gray-200 animate-pulse"})]})]})})})]}),r.isError&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600 rounded-none",children:"Falha ao carregar esta noticia. Tente novamente."})}),!r.isLoading&&!r.isError&&!s&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600 rounded-none",children:"Noticia nao encontrada."})}),!r.isLoading&&!r.isError&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"relative overflow-hidden bg-[#1c1b1a] text-white",children:[N?e.jsx("img",{src:N,alt:s.title,className:"absolute inset-0 h-full w-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#3d2f23] to-[#0f0c0a]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/80 via-black/55 to-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsxs("div",{className:"max-w-3xl space-y-5",children:[f&&e.jsx("span",{className:`${_(f.slug||f.name)} inline-flex px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] rounded-none`,children:f.name}),e.jsx("h1",{className:"text-2xl font-semibold leading-tight md:text-4xl",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs uppercase tracking-[0.3em] text-white/70",children:[v&&e.jsx("span",{children:v}),s.author?.name&&e.jsx("span",{children:s.author.name})]})]})})})]}),e.jsx("main",{className:"py-20",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-15",children:e.jsxs("div",{className:"grid gap-12 lg:grid-cols-[1fr_320px]",children:[e.jsxs("article",{className:"space-y-10",children:[w&&e.jsx("p",{className:"text-lg leading-relaxed text-gray-700",children:w}),s.body?e.jsx("div",{className:"post-content text-gray-700",dangerouslySetInnerHTML:{__html:s.body}}):e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600 rounded-none",children:"Este post ainda nao tem conteudo publicado."}),(s.categories?.length||s.tags?.length)&&e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[s.categories&&s.categories.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-gray-500",children:"Categorias"}),s.categories.map(a=>e.jsx("a",{href:`/noticias?categoria=${a.slug}`,className:"border border-gray-200 px-3 py-1 text-xs uppercase tracking-[0.2em] text-gray-700 transition-colors hover:border-gray-400 rounded-none",children:a.name},a.id))]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-gray-500",children:"Tags"}),s.tags.map(a=>e.jsx("a",{href:`/noticias?tag=${a.slug}`,className:"border border-gray-200 px-3 py-1 text-xs uppercase tracking-[0.2em] text-gray-700 transition-colors hover:border-gray-400 rounded-none",children:a.name},a.id))]})]}),s.author&&e.jsx("div",{className:"border border-gray-200 bg-white p-6 rounded-none",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"h-16 w-16 overflow-hidden bg-[#f4f1ec]",children:s.author.photo_url?e.jsx("img",{src:s.author.photo_url,alt:s.author.name??"Autor",className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xl font-semibold text-gray-400",children:(s.author.name??"A").charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-gray-500",children:"Autor"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.author.name??"Equipe"}),s.author.email&&e.jsx("p",{className:"text-sm text-gray-600",children:s.author.email})]})]})}),m.isLoading&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-48 bg-gray-200 animate-pulse"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:Array.from({length:2}).map((a,t)=>e.jsx("div",{className:"h-48 bg-gray-200 animate-pulse"},`related-skeleton-${t}`))})]}),!m.isLoading&&!m.isError&&(m.data?.length??0)>0&&e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Posts relacionados"})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:m.data?.map(a=>{const t=a.categories?.[0],x=t?_(t.slug||t.name):"",g=y(a.published_at??a.created_at);return e.jsxs("a",{href:`/noticias/${a.slug}`,className:"group relative flex min-h-56 flex-col justify-end overflow-hidden border border-gray-200 bg-white text-left transition-transform hover:-translate-y-1 rounded-none",children:[a.featured_image_url?e.jsx("img",{src:a.featured_image_url,alt:a.title,className:"absolute inset-0 h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#e6ddd3] to-[#cbbfb4]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-black/10"}),t&&e.jsx("span",{className:`${x} absolute left-4 top-4 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] rounded-none`,children:t.name}),e.jsxs("div",{className:"relative z-10 space-y-3 p-6 text-white",children:[e.jsx("h3",{className:"text-lg font-semibold leading-snug md:text-xl",children:a.title}),e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-white/80",children:g})]})]},a.id)})})]})]}),e.jsxs("aside",{className:"space-y-8",children:[e.jsx(j,{title:"Pesquisar",children:e.jsxs("form",{action:"/noticias",method:"get",className:"flex gap-2",children:[e.jsx("input",{type:"search",name:"q",placeholder:"Buscar...",className:"w-full border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 focus:border-gray-400 focus:outline-none rounded-none"}),e.jsx("button",{type:"submit",className:"bg-[color:var(--brand)] px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white transition-colors hover:bg-[#a25a2c] rounded-none",children:"Ir"})]})}),e.jsxs(j,{title:"Noticias recentes",children:[o.isLoading&&e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((a,t)=>e.jsx("div",{className:"h-10 w-full bg-gray-200 animate-pulse"},`recent-skeleton-${t}`))}),o.isError&&e.jsx("p",{className:"text-sm text-gray-600",children:"Falha ao carregar noticias."}),!o.isLoading&&!o.isError&&(o.data??[]).length===0&&e.jsx("p",{className:"text-sm text-gray-600",children:"Sem noticias publicadas."}),!o.isLoading&&!o.isError&&(o.data??[]).length>0&&e.jsx("ul",{className:"space-y-4 text-sm text-gray-700",children:o.data?.filter(a=>a.id!==s.id).map(a=>e.jsxs("li",{className:"space-y-1",children:[e.jsx("a",{href:`/noticias/${a.slug}`,className:"font-semibold text-gray-900 hover:text-[color:var(--brand)]",children:a.title}),e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-gray-500",children:y(a.published_at??a.created_at)})]},a.id))})]}),e.jsxs(j,{title:"Tags",children:[n.isLoading&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:6}).map((a,t)=>e.jsx("div",{className:"h-7 w-16 bg-gray-200 animate-pulse"},`tag-skeleton-${t}`))}),n.isError&&e.jsx("p",{className:"text-sm text-gray-600",children:"Falha ao carregar tags."}),!n.isLoading&&!n.isError&&(n.data??[]).length===0&&e.jsx("p",{className:"text-sm text-gray-600",children:"Sem tags disponiveis."}),!n.isLoading&&!n.isError&&(n.data??[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:n.data?.map(a=>e.jsx("a",{href:`/noticias?tag=${a.slug}`,className:"border border-gray-200 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-gray-700 transition-colors hover:border-gray-400 rounded-none",children:a.name},a.id))})]})]})]})})})]})]})}export{A as component};
