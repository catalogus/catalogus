import{c as L,j as e,r as u,u as z,s as M}from"./main-B5FlV0ud.js";import{u as H}from"./useInfiniteQuery-CrAj8iZp.js";import{H as I}from"./Header-DLdij8DV.js";import{c as Q,X as R}from"./x-DfPbw0Sj.js";import{S as K}from"./search-BWiiaxVB.js";import{P as Z}from"./ProductCard-Dgb16qrd.js";import"./link-2-DMSZLQdF.js";const D=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],G=Q("sliders-horizontal",D),E=(d,b,c)=>Math.max(b,Math.min(d,c));function T({search:d,onSearchChange:b,categories:c,selectedCategories:x,onSelectedCategoriesChange:g,language:f,onLanguageChange:r,priceRange:l,selectedPrice:o,onPriceChange:j,onClearFilters:w,isLoading:m=!1,className:k,idPrefix:v="shop"}){const N=s=>{const a=x.includes(s)?x.filter(p=>p!==s):[...x,s];g(a)},n=s=>{const t=E(s,l.min,o.max);j({min:t,max:o.max})},i=s=>{const t=E(s,o.min,l.max);j({min:o.min,max:t})},h=L(l.min),C=L(l.max),y=`${v}-search`;return e.jsxs("aside",{className:`space-y-6 border border-gray-200 bg-white p-6 ${k??""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),e.jsxs("button",{type:"button",onClick:w,className:"inline-flex items-center gap-1 text-xs font-semibold uppercase tracking-wider text-gray-500 transition-colors hover:text-gray-900",disabled:m,children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Limpar"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:y,children:"Pesquisa"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:y,type:"search",value:d,onChange:s=>b(s.target.value),placeholder:"Buscar por titulo",className:"w-full border border-gray-200 bg-white py-2 pl-10 pr-3 text-sm text-gray-900 focus:border-[color:var(--brand)] focus:outline-none",disabled:m})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500",children:"Categorias"}),c.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma categoria encontrada."}):e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:x.includes(s),onChange:()=>N(s),className:"h-4 w-4 border-gray-300 text-[color:var(--brand)] focus:ring-[color:var(--brand)]",disabled:m}),e.jsx("span",{children:s})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500",children:"Idioma"}),e.jsx("div",{className:"space-y-2 text-sm text-gray-700",children:[{label:"Todos",value:null},{label:"Portugues",value:"pt"},{label:"Ingles",value:"en"}].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"language",checked:f===s.value,onChange:()=>r(s.value),className:"h-4 w-4 border-gray-300 text-[color:var(--brand)] focus:ring-[color:var(--brand)]",disabled:m}),e.jsx("span",{children:s.label})]},s.label))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500",children:"Preco"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[h," MZN - ",C," MZN"]}),e.jsxs("div",{className:"grid gap-3 text-sm text-gray-700 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Minimo"}),e.jsx("input",{type:"number",min:l.min,max:o.max,value:o.min,onChange:s=>n(Number(s.target.value)),className:"w-full border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 focus:border-[color:var(--brand)] focus:outline-none",disabled:m})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Maximo"}),e.jsx("input",{type:"number",min:o.min,max:l.max,value:o.max,onChange:s=>i(Number(s.target.value)),className:"w-full border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 focus:border-[color:var(--brand)] focus:outline-none",disabled:m})]})]})]})]})}const S={min:0,max:1e4};function ee(){const[d,b]=u.useState(""),[c,x]=u.useState([]),[g,f]=u.useState(null),[r,l]=u.useState({min:0,max:0}),[o,j]=u.useState("newest"),[w,m]=u.useState(!1),k=u.useRef(S),v=z({queryKey:["shop-categories"],queryFn:async()=>{const{data:t,error:a}=await M.from("books").select("category").eq("is_active",!0).not("category","is",null);if(a)throw a;return Array.from(new Set(t?.map(_=>_.category).filter(Boolean))).sort()},staleTime:3e5}),N=z({queryKey:["shop-price-range"],queryFn:async()=>{const{data:t,error:a}=await M.from("books").select("price_mzn").eq("is_active",!0).not("price_mzn","is",null).order("price_mzn",{ascending:!1}).limit(1);if(a)throw a;const p=t?.[0]?.price_mzn??S.max;return{min:0,max:Math.ceil(p/100)*100}},staleTime:3e5}),n=N.data??S;u.useEffect(()=>{const t=k.current;(r.max===0||r.min===t.min&&r.max===t.max)&&l(n),k.current=n},[n,r.max,r.min]);const i=H({queryKey:["books","shop",{search:d,selectedCategories:c,language:g,selectedPrice:r,sortBy:o}],queryFn:async({pageParam:t=1})=>{let a=M.from("books").select(`
          id,
          title,
          slug,
          price_mzn,
          stock,
          description,
          seo_description,
          cover_url,
          cover_path,
          category,
          language,
          authors:authors_books(author:authors(id, name, wp_slug))
        `).eq("is_active",!0);const p=d.trim();switch(p&&(a=a.or(`title.ilike.%${p}%,description.ilike.%${p}%`)),c.length>0&&(a=a.in("category",c)),g&&(a=a.eq("language",g)),r.min>n.min&&(a=a.gte("price_mzn",r.min)),r.max<n.max&&(a=a.lte("price_mzn",r.max)),o){case"newest":a=a.order("created_at",{ascending:!1});break;case"oldest":a=a.order("created_at",{ascending:!0});break;case"price-asc":a=a.order("price_mzn",{ascending:!0,nullsFirst:!1});break;case"price-desc":a=a.order("price_mzn",{ascending:!1,nullsFirst:!1});break;case"title":a=a.order("title",{ascending:!0});break}const _=(t-1)*12,A=_+11,{data:$,error:F}=await a.range(_,A);if(F)throw F;const P=$?.map(q=>({...q,authors:q.authors?.map(B=>({author:B.author}))??[]}))??[];return{books:P,hasMore:P.length===12}},getNextPageParam:(t,a)=>t.hasMore?a.length+1:void 0,initialPageParam:1,staleTime:6e4}),h=i.data?.pages.flatMap(t=>t.books)??[],C=v.data??[],y=()=>{b(""),x([]),f(null),l(n),j("newest")},s=(d?1:0)+(c.length>0?1:0)+(g?1:0)+(r.min>n.min||r.max<n.max?1:0);return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(I,{}),e.jsx("section",{className:"bg-[#1c1b1a] text-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-16 lg:px-15",children:[e.jsx("h1",{className:"text-4xl font-semibold md:text-6xl",children:"Loja"}),e.jsx("p",{className:"mt-4 text-lg text-white/80",children:"Descubra a nossa colecao de livros"})]})}),e.jsx("main",{className:"py-12",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-15",children:e.jsxs("div",{className:"lg:grid lg:grid-cols-[280px_1fr] lg:gap-12",children:[e.jsx("aside",{className:"hidden lg:block",children:e.jsx("div",{className:"sticky top-4",children:e.jsx(T,{idPrefix:"shop-desktop",search:d,onSearchChange:b,categories:C,selectedCategories:c,onSelectedCategoriesChange:x,language:g,onLanguageChange:f,priceRange:n,selectedPrice:r,onPriceChange:l,onClearFilters:y,isLoading:v.isLoading||N.isLoading})})}),e.jsxs("div",{className:"mb-6 lg:hidden",children:[e.jsxs("button",{type:"button",onClick:()=>m(!w),className:"flex w-full items-center justify-center gap-2 border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium",children:[e.jsx(G,{className:"h-4 w-4"}),"Filtros",s>0&&e.jsx("span",{className:"ml-1 rounded-full bg-[color:var(--brand)] px-2 py-0.5 text-xs text-white",children:s})]}),w&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx(T,{idPrefix:"shop-mobile",search:d,onSearchChange:b,categories:C,selectedCategories:c,onSelectedCategoriesChange:x,language:g,onLanguageChange:f,priceRange:n,selectedPrice:r,onPriceChange:l,onClearFilters:y,isLoading:v.isLoading||N.isLoading}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"w-full bg-[color:var(--brand)] px-4 py-2.5 text-sm font-semibold uppercase tracking-wider text-white hover:bg-[#a25a2c]",children:"Fechar filtros"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.isSuccess&&e.jsx(e.Fragment,{children:h.length>0?`${h.length} ${h.length===1?"livro encontrado":"livros encontrados"}`:"Nenhum livro encontrado"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"sort",className:"text-sm text-gray-600",children:"Ordenar:"}),e.jsxs("select",{id:"sort",value:o,onChange:t=>j(t.target.value),className:"border border-gray-300 bg-white px-3 py-1.5 text-sm focus:border-[color:var(--brand)] focus:outline-none",children:[e.jsx("option",{value:"newest",children:"Mais recentes"}),e.jsx("option",{value:"oldest",children:"Mais antigos"}),e.jsx("option",{value:"price-asc",children:"Preco: Baixo para Alto"}),e.jsx("option",{value:"price-desc",children:"Preco: Alto para Baixo"}),e.jsx("option",{value:"title",children:"Titulo (A-Z)"})]})]})]}),i.isLoading&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Array.from({length:12}).map((t,a)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-[3/4] w-full animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-5 w-3/4 animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-6 w-1/3 animate-pulse bg-gray-200"})]},`skeleton-${a}`))}),i.isError&&e.jsx("div",{className:"border border-gray-200 bg-white p-8 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Falha ao carregar os livros. Tente novamente."})}),!i.isLoading&&!i.isError&&h.length===0&&e.jsxs("div",{className:"border border-gray-200 bg-white p-8 text-center",children:[e.jsx("p",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Nenhum livro encontrado"}),e.jsx("p",{className:"mb-6 text-sm text-gray-600",children:"Tente ajustar os filtros ou pesquisar por outro termo"}),s>0&&e.jsx("button",{type:"button",onClick:y,className:"bg-[color:var(--brand)] px-6 py-2.5 text-sm font-semibold uppercase tracking-wider text-white hover:bg-[#a25a2c]",children:"Limpar filtros"})]}),!i.isLoading&&!i.isError&&h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:h.map(t=>e.jsx(Z,{book:t},t.id))}),i.hasNextPage&&e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>i.fetchNextPage(),disabled:i.isFetchingNextPage,className:"bg-[color:var(--brand)] px-8 py-3 text-sm font-semibold uppercase tracking-wider text-white transition-colors hover:bg-[#a25a2c] disabled:cursor-not-allowed disabled:opacity-50",children:i.isFetchingNextPage?"Carregando...":"Carregar mais"})}),i.isFetchingNextPage&&e.jsx("div",{className:"mt-8 grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Array.from({length:12}).map((t,a)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-[3/4] w-full animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-5 w-3/4 animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse bg-gray-200"})]},`loading-more-${a}`))})]})]})]})})})]})}export{ee as component};
