import{p as u,u as n,b,g,j as e,f as o,L as h,s as c}from"./main-B5FlV0ud.js";import{H as y}from"./Header-DLdij8DV.js";import"./x-DfPbw0Sj.js";async function j(t){return{success:!0,instructions:`Envie ${t.total} MZN para o numero M-Pesa: +258 84 XXX XXXX`,reference:t.order_number}}const l=t=>t.book?.cover_url?t.book.cover_url:t.book?.cover_path?c.storage.from("covers").getPublicUrl(t.book.cover_path).data.publicUrl:null;function w(){const{orderId:t}=u.useParams(),a=n({queryKey:["order",t],queryFn:async()=>{const{data:s,error:i}=await c.from("orders").select(`
          id,
          order_number,
          customer_name,
          customer_email,
          customer_phone,
          total,
          status,
          created_at,
          items:order_items(
            id,
            quantity,
            price,
            book:books(id, title, cover_url, cover_path)
          )
        `).eq("id",t).maybeSingle();if(i)throw i;return s??null},staleTime:6e4}),r=a.data,d=r?.order_number??"",x=r?b(r.status):"",m=r?g(r.status):"",p=n({queryKey:["mpesa",r?.order_number],queryFn:async()=>r?j({order_number:r.order_number,total:Number(r.total)}):null,enabled:!!r});return e.jsxs("div",{className:"min-h-screen bg-[#f8f4ef] text-gray-900",children:[e.jsx(y,{}),a.isLoading&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"h-64 animate-pulse border border-gray-200 bg-gray-100"})}),a.isError&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Falha ao carregar o pedido. Tente novamente."})}),!a.isLoading&&!a.isError&&!r&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Pedido nao encontrado."})}),!a.isLoading&&!a.isError&&r&&e.jsx("main",{className:"container mx-auto px-4 py-16 lg:px-15",children:e.jsxs("div",{className:"space-y-6 border border-gray-200 bg-white p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Pedido confirmado"}),e.jsx("h1",{className:"mt-2 text-2xl font-semibold md:text-3xl",children:d})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${m}`,children:x})]}),e.jsxs("div",{className:"grid gap-4 text-sm text-gray-700 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs uppercase tracking-wider text-gray-500",children:"Cliente"}),e.jsx("span",{children:r.customer_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs uppercase tracking-wider text-gray-500",children:"Contacto"}),e.jsxs("span",{children:[r.customer_email," | ",r.customer_phone]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Itens"}),e.jsx("div",{className:"mt-4 space-y-4",children:(r.items??[]).map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-12 flex-shrink-0 bg-gray-100",children:l(s)?e.jsx("img",{src:l(s)??"",alt:s.book?.title??"Livro",className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-semibold text-gray-300",children:s.book?.title?.charAt(0).toUpperCase()??"L"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.book?.title??"Livro"}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.quantity," x ",o(s.price)]})]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:o(s.price*s.quantity)})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 pt-4 text-sm text-gray-700",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:o(r.total)})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 text-sm text-gray-700",children:[e.jsx("h3",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Pagamento M-Pesa"}),e.jsx("p",{className:"mt-2",children:p.data?.instructions??"As instrucoes de pagamento estarao disponiveis em breve."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 border-t border-gray-200 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>window.print(),className:"border border-gray-300 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-wider text-gray-700 hover:border-gray-400",children:"Imprimir pedido"}),e.jsx(h,{to:"/loja",className:"bg-[color:var(--brand)] px-4 py-2 text-xs font-semibold uppercase tracking-wider text-white hover:bg-[#a25a2c]",children:"Voltar a loja"})]})]})})]})}export{w as component};
