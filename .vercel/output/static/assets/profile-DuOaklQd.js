import{a as w,d as _,r as v,j as e,B as k,t as N,s as y}from"./main-B5FlV0ud.js";import{u as P}from"./useMutation-DsfTo1KK.js";import{I as h,B as S}from"./button-BmSOyNex.js";import{L as c}from"./label-Chk9yu5q.js";import{S as C}from"./StatusBadge-wyWTkgTV.js";function F({children:s}){const{session:o,profile:d,loading:t}=w(),u=_();return v.useEffect(()=>{t||(!o||d?.role!=="author")&&u({to:"/author/sign-in",replace:!0})},[o,d?.role,t,u]),t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading..."})]})}):!o||d?.role!=="author"?null:e.jsx(e.Fragment,{children:s})}const x={name:"",phone:"",bio:"",photo_url:"",photo_path:"",social_links:{}};function L({profile:s,onSubmit:o,submitting:d=!1}){const[t,u]=v.useState({name:s.name??x.name,phone:s.phone??x.phone,bio:s.bio??x.bio,photo_url:s.photo_url??x.photo_url,photo_path:s.photo_path??x.photo_path,social_links:s.social_links??x.social_links}),[g,f]=v.useState(s.photo_url??null),[n,r]=v.useState(null),i=(a,m)=>{u(b=>({...b,[a]:m}))},l=(a,m)=>{u(b=>({...b,social_links:{...b.social_links,[a]:m||void 0}}))},p=a=>{const m=a.target.files?.[0]??null;r(m),m&&f(URL.createObjectURL(m))},j=a=>{a.preventDefault(),o(t,n)};return e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Account Status"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.status==="pending"&&"Your account is pending admin approval",s.status==="approved"&&"Your account has been approved",s.status==="rejected"&&"Your account has been rejected. Please contact admin."]})]}),e.jsx(C,{label:s.status??"pending",variant:s.status==="approved"?"success":s.status==="rejected"?"danger":"warning"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:s.email??"",disabled:!0,className:"bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Email cannot be changed. Contact admin if needed."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"name",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"name",type:"text",value:t.name,onChange:a=>i("name",a.target.value),required:!0,minLength:2,maxLength:100,placeholder:"Your name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Phone"}),e.jsx(h,{id:"phone",type:"tel",value:t.phone,onChange:a=>i("phone",a.target.value),placeholder:"+258 84 123 4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",value:t.bio,onChange:a=>i("bio",a.target.value),maxLength:500,rows:4,placeholder:"Tell us about yourself (max 500 characters)",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-900 focus:outline-none focus:ring-1 focus:ring-gray-900"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.bio.length,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"photo",children:"Profile Photo"}),g&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:g,alt:"Preview",className:"h-32 w-32 rounded-lg object-cover border border-gray-200"})}),e.jsx(h,{id:"photo",type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:p}),e.jsx("p",{className:"text-xs text-gray-500",children:"Max 5MB. Supported formats: JPG, PNG, WEBP, GIF"})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Social Links"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"twitter",children:"Twitter"}),e.jsx(h,{id:"twitter",type:"url",value:t.social_links.twitter??"",onChange:a=>l("twitter",a.target.value),placeholder:"https://twitter.com/username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"linkedin",children:"LinkedIn"}),e.jsx(h,{id:"linkedin",type:"url",value:t.social_links.linkedin??"",onChange:a=>l("linkedin",a.target.value),placeholder:"https://linkedin.com/in/username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"website",children:"Website"}),e.jsx(h,{id:"website",type:"url",value:t.social_links.website??"",onChange:a=>l("website",a.target.value),placeholder:"https://example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"instagram",children:"Instagram"}),e.jsx(h,{id:"instagram",type:"url",value:t.social_links.instagram??"",onChange:a=>l("instagram",a.target.value),placeholder:"https://instagram.com/username"})]})]})]}),e.jsx("div",{className:"flex justify-end border-t pt-4",children:e.jsx(S,{type:"submit",disabled:d,children:d?"Saving...":"Save Changes"})})]})}function M(){const{profile:s,session:o,signOut:d}=w(),t=k(),u=async(n,r)=>{const i=`author-photos/${r}/${Date.now()}-${n.name}`,{error:l}=await y.storage.from("author-photos").upload(i,n,{upsert:!0});if(l)throw l;const{data:p}=y.storage.from("author-photos").getPublicUrl(i);return{path:i,publicUrl:p.publicUrl}},g=P({mutationFn:async n=>{const{values:r,file:i}=n;if(!o?.user?.id)throw new Error("Not authenticated");let l=r.photo_path,p=r.photo_url;if(i){r.photo_path&&await y.storage.from("author-photos").remove([r.photo_path]);const a=await u(i,o.user.id);p=a.publicUrl,l=a.path}const{error:j}=await y.from("profiles").update({name:r.name,phone:r.phone,bio:r.bio,photo_url:p,photo_path:l,social_links:r.social_links}).eq("id",o.user.id);if(j)throw j},onSuccess:()=>{t.invalidateQueries({queryKey:["profile",o?.user?.id]}),N.success("Profile updated successfully")},onError:n=>{console.error("Update profile error:",n),N.error(n.message??"Failed to update profile")}}),f=async(n,r)=>{await g.mutateAsync({values:n,file:r})};return s?e.jsx(F,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your author profile information"})]}),e.jsx("button",{onClick:()=>d(),className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:"Sign Out"})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-8",children:e.jsx(L,{profile:{id:s.id,name:s.name??"",email:o?.user?.email,phone:s.phone,bio:s.bio,photo_url:s.photo_url,photo_path:s.photo_path,social_links:s.social_links,status:s.status},onSubmit:f,submitting:g.isPending})})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-gray-500",children:"Loading profile..."})})}export{M as component};
