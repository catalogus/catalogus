import{v as C,e as E,r as b,u as f,k as q,w as L,j as e,f as z,x as Q,y as T,s as x,t as N,z as I}from"./main-B5FlV0ud.js";import{H as P}from"./Header-DLdij8DV.js";import{P as $}from"./ProductCard-Dgb16qrd.js";import{Q as F}from"./QuantitySelector-BPha7X9v.js";import{S as U}from"./x-DfPbw0Sj.js";import"./link-2-DMSZLQdF.js";const A=i=>i.cover_url?i.cover_url:i.cover_path?x.storage.from("covers").getPublicUrl(i.cover_path).data.publicUrl:null;function G(){const{bookId:i}=C.useParams(),{addToCart:w}=E(),[v,m]=b.useState(1),[h,y]=b.useState("description"),o=f({queryKey:["book",i],queryFn:async()=>{const a="id, title, slug, price_mzn, stock, description, seo_description, cover_url, cover_path, isbn, publisher, category, language, authors:authors_books(author:authors(id, name, wp_slug))",{data:r,error:d}=await x.from("books").select(a).eq("slug",i).eq("is_active",!0).maybeSingle();if(d)throw d;if(r)return r;const{data:p,error:j}=await x.from("books").select(a).eq("id",i).eq("is_active",!0).maybeSingle();if(j)throw j;return p??null},staleTime:6e4}),s=o.data??null,l=s?A(s):null,n=s?.stock??0,g=q(n),c=L(n),k=Q(n),_=T(n);b.useEffect(()=>{if(s){if(!c){m(1);return}m(a=>Math.min(Math.max(a,1),g||1))}},[s,c,g]);const t=f({queryKey:["related-books",s?.id,s?.category],queryFn:async()=>{if(!s?.category)return[];const{data:a,error:r}=await x.from("books").select(`
          id,
          title,
          slug,
          price_mzn,
          stock,
          description,
          seo_description,
          cover_url,
          cover_path,
          category,
          language,
          authors:authors_books(author:authors(id, name, wp_slug))
        `).eq("is_active",!0).eq("category",s.category).neq("id",s.id).limit(4);if(r)throw r;return a?.map(d=>({...d,authors:d.authors?.map(p=>({author:p.author}))??[]}))??[]},enabled:!!s,staleTime:6e4}),u=s?.authors?.map(a=>{if(!a.author)return null;const r=a.author.wp_slug||a.author.id;return{id:a.author.id,name:a.author.name,href:`/autor/${r}`}}).filter(Boolean)??[],S=()=>{if(s){if(!c){N.error("Este livro esta esgotado");return}w({id:s.id,title:s.title,slug:s.slug??s.id,price_mzn:s.price_mzn??0,stock:n,cover_url:l},v),N.success(`"${I(s.title,40)}" adicionado ao carrinho`)}};return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(P,{}),o.isLoading&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"h-72 rounded-none border border-gray-200 bg-gray-100 animate-pulse"})}),o.isError&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600 rounded-none",children:"Falha ao carregar o livro. Tente novamente."})}),!o.isLoading&&!o.isError&&!s&&e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600 rounded-none",children:"Livro nao encontrado."})}),!o.isLoading&&!o.isError&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"relative overflow-hidden bg-[#1c1b1a] text-white",style:l?{backgroundImage:`url(${l})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[e.jsx("div",{className:"absolute inset-0 bg-black/60"}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-20 lg:px-15",children:e.jsxs("div",{className:"max-w-3xl space-y-4",children:[e.jsx("h1",{className:"text-4xl font-semibold md:text-6xl",children:s.title}),e.jsxs("div",{className:"text-xs uppercase tracking-[0.3em] text-white/70",children:[e.jsx("a",{href:"/",className:"hover:text-white",children:"Home"})," ","/"," ",e.jsx("a",{href:"/loja",className:"hover:text-white",children:"Loja"})," ","/ ",s.title]})]})})})]}),e.jsxs("main",{className:"container mx-auto px-4 py-16 lg:px-15",children:[e.jsxs("div",{className:"grid gap-10 lg:grid-cols-[minmax(0,420px)_1fr]",children:[e.jsx("div",{className:"bg-[#f2eee9] p-10 shadow-sm",children:e.jsx("div",{className:"aspect-[3/4] w-full overflow-hidden bg-white",children:l?e.jsx("img",{src:l,alt:s.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-4xl font-semibold text-gray-300",children:s.title.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-semibold md:text-4xl",children:s.title}),u.length>0&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:u.map((a,r)=>e.jsxs("span",{children:[e.jsx("a",{href:a.href,className:"hover:text-gray-900",children:a.name}),r<u.length-1?", ":""]},a.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-2xl font-bold text-[color:var(--brand)]",children:z(s.price_mzn??0)}),e.jsx("p",{className:`text-sm font-medium ${_}`,children:k})]}),e.jsx("div",{className:"space-y-4 text-sm text-gray-700",children:e.jsx("p",{children:s.description||s.seo_description||"Descricao indisponivel."})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(F,{value:v,onChange:m,min:1,max:g||1,disabled:!c}),e.jsxs("button",{type:"button",onClick:S,disabled:!c,className:"flex items-center gap-2 bg-[color:var(--brand)] px-6 py-3 text-sm font-semibold uppercase tracking-wider text-white transition-colors hover:bg-[#a25a2c] disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500",children:[e.jsx(U,{className:"h-4 w-4"}),c?"Adicionar ao carrinho":"Esgotado"]})]}),e.jsxs("div",{className:"space-y-2 text-xs uppercase tracking-wider text-gray-500",children:[e.jsxs("p",{children:["Categoria:"," ",e.jsx("span",{className:"text-gray-700 normal-case",children:s.category||"Nao informado"})]}),e.jsxs("p",{children:["Idioma:"," ",e.jsx("span",{className:"text-gray-700 normal-case",children:s.language?.toUpperCase()||"Nao informado"})]}),e.jsxs("p",{children:["ISBN:"," ",e.jsx("span",{className:"text-gray-700 normal-case",children:s.isbn||"Nao informado"})]}),e.jsxs("p",{children:["ID:"," ",e.jsx("span",{className:"text-gray-700 normal-case",children:s.id})]})]})]})]}),e.jsxs("section",{className:"mt-12",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y("description"),className:`px-4 py-2 text-xs font-semibold uppercase tracking-wider transition-colors ${h==="description"?"bg-[color:var(--brand)] text-white":"bg-white text-gray-600 hover:text-gray-900"}`,children:"Descricao"}),e.jsx("button",{type:"button",onClick:()=>y("reviews"),className:`px-4 py-2 text-xs font-semibold uppercase tracking-wider transition-colors ${h==="reviews"?"bg-[color:var(--brand)] text-white":"bg-white text-gray-600 hover:text-gray-900"}`,children:"Reviews (0)"})]}),e.jsx("div",{className:"mt-4 border border-gray-200 bg-white p-6 text-sm text-gray-700",children:h==="description"?e.jsx("p",{children:s.description||s.seo_description||"Descricao indisponivel."}):e.jsx("p",{children:"Sem reviews ainda."})})]}),e.jsxs("section",{className:"mt-16",children:[e.jsx("div",{className:"mb-8 flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-semibold md:text-3xl",children:"Livros relacionados"})}),t.isLoading&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((a,r)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-[3/4] w-full animate-pulse bg-gray-200"}),e.jsx("div",{className:"h-5 w-3/4 animate-pulse bg-gray-200"})]},`related-skeleton-${r}`))}),t.isError&&e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Falha ao carregar livros relacionados."}),!t.isLoading&&!t.isError&&(t.data?.length??0)===0&&e.jsx("div",{className:"border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Sem livros relacionados no momento."}),!t.isLoading&&!t.isError&&(t.data?.length??0)>0&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:(t.data??[]).map(a=>e.jsx($,{book:a,compact:!0},a.id))})]})]})]})]})}export{G as component};
