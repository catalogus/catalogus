import{R as w,u as _,j as e,s as g}from"./main-B5FlV0ud.js";import{u as v}from"./useInfiniteQuery-CrAj8iZp.js";import{H as k}from"./Header-DLdij8DV.js";import"./x-DfPbw0Sj.js";const P=s=>{if(!s)return"";const r=new Date(s);return Number.isNaN(r.getTime())?"":r.toLocaleDateString("pt-PT",{day:"2-digit",month:"long",year:"numeric"})},q=s=>s?s.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():"",C=s=>{const r=q(s);return r?r.length<=220?r:`${r.slice(0,220).trim()}...`:""},$=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),F={noticias:"bg-[#c6f36d] text-black",eventos:"bg-[#ffd166] text-black",cultura:"bg-[#5de2ff] text-black",literatura:"bg-[#ff8fab] text-black",opiniao:"bg-[#bdb2ff] text-black",entrevistas:"bg-[#a6ff8f] text-black",lancamentos:"bg-[#ffc6ff] text-black"},y=s=>{const r=$(s);return F[r]??"bg-[#c6f36d] text-black"};function T(){const{q:s,categoria:r,tag:c}=w.useSearch(),m=_({queryKey:["news-posts","featured-spotlight"],queryFn:async()=>{const{data:a,error:t}=await g.from("posts").select(`
          id,
          title,
          slug,
          featured_image_url,
          categories:post_categories_map(category:post_categories(name, slug))
        `).eq("status","published").eq("featured",!0);if(t)throw t;if(!a||a.length===0)return null;const d=Math.floor(Math.random()*a.length),l=a[d];return{...l,categories:l.categories?.map(u=>({category:u.category}))??[]}},staleTime:6e4}),i=v({queryKey:["news-posts","listing",s,r,c,m.data?.id],queryFn:async({pageParam:a=1})=>{let t=g.from("posts").select(`
          id,
          title,
          slug,
          excerpt,
          body,
          featured_image_url,
          published_at,
          created_at,
          categories:post_categories_map(category:post_categories(name, slug))
        `).eq("status","published").order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1});if(m.data?.id&&(t=t.neq("id",m.data.id)),s&&(t=t.or(`title.ilike.%${s}%,excerpt.ilike.%${s}%`)),r){const{data:n}=await g.from("post_categories").select("id").eq("slug",r).maybeSingle();if(n){const{data:x}=await g.from("post_categories_map").select("post_id").eq("category_id",n.id),p=x?.map(b=>b.post_id)??[];if(p.length>0)t=t.in("id",p);else return{posts:[],hasMore:!1}}else return{posts:[],hasMore:!1}}if(c){const{data:n}=await g.from("post_tags").select("id").eq("slug",c).maybeSingle();if(n){const{data:x}=await g.from("post_tags_map").select("post_id").eq("tag_id",n.id),p=x?.map(b=>b.post_id)??[];if(p.length>0)t=t.in("id",p);else return{posts:[],hasMore:!1}}else return{posts:[],hasMore:!1}}const d=(a-1)*6,l=d+5,{data:u,error:N}=await t.range(d,l);if(N)throw N;const j=u?.map(n=>({...n,categories:n.categories?.map(x=>({category:x.category}))??[]}))??[];return{posts:j,hasMore:j.length===6}},getNextPageParam:(a,t)=>a.hasMore?t.length+1:void 0,initialPageParam:1,staleTime:6e4,enabled:m.isSuccess}),h=i.data?.pages.flatMap(a=>a.posts)??[],o=m.data,f=o?.categories?.[0]?.category;return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(k,{}),e.jsxs("section",{className:"relative overflow-hidden bg-[#1c1b1a] text-white",children:[o&&o.featured_image_url&&e.jsx("img",{src:o.featured_image_url,alt:o.title,className:"absolute inset-0 h-full w-full object-cover"}),(!o||!o.featured_image_url)&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#3d2f23] to-[#0f0c0a]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/80 via-black/55 to-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-24 lg:px-15",children:e.jsxs("div",{className:"max-w-3xl space-y-5",children:[o&&f?e.jsx("span",{className:`${y(f.slug||f.name||"")} inline-flex px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] rounded-none`,children:f.name}):e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/70",children:"Notícias"}),e.jsx("h1",{className:"text-2xl font-semibold leading-tight md:text-4xl",children:o?o.title:"Notícias"}),o&&e.jsx("a",{href:`/noticias/${o.slug}`,className:"inline-flex items-center gap-2 bg-[color:var(--brand)] px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white transition-colors hover:bg-[#a25a2c]",children:"Ler artigo completo"}),(s||r||c)&&e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs uppercase tracking-[0.3em] text-white/70",children:[s&&e.jsxs("span",{children:['Pesquisa: "',s,'"']}),r&&e.jsxs("span",{children:["Categoria: ",r]}),c&&e.jsxs("span",{children:["Tag: ",c]})]})]})})})]}),e.jsx("main",{className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-15",children:[i.isLoading&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((a,t)=>e.jsx("div",{className:"h-[420px] animate-pulse rounded-none border border-white/10 bg-white/5"},`skeleton-${t}`))}),i.isError&&e.jsx("div",{className:"rounded-none border border-white/10 bg-white/5 p-6 text-sm text-white/70",children:"Falha ao carregar as notícias. Tente novamente."}),!i.isLoading&&!i.isError&&h.length===0&&e.jsx("div",{className:"rounded-none border border-white/10 bg-white/5 p-6 text-sm text-white/70",children:"Nenhuma notícia encontrada."}),!i.isLoading&&!i.isError&&h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:h.map(a=>{const t=a.categories?.[0]?.category,d=P(a.published_at??a.created_at),l=a.excerpt?.trim()||C(a.body),u=t?.slug?y(t.slug):t?.name?y(t.name):"";return e.jsxs("a",{href:`/noticias/${a.slug}`,className:"group relative flex min-h-105 flex-col justify-end overflow-hidden rounded-none border border-white/10 bg-white/5 text-left transition-transform hover:-translate-y-1",children:[a.featured_image_url?e.jsx("img",{src:a.featured_image_url,alt:a.title,className:"absolute inset-0 h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-neutral-700 to-neutral-900"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/10"}),t&&e.jsx("span",{className:`${u} absolute left-4 top-4 rounded-none px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em]`,children:t.name}),e.jsxs("div",{className:"relative z-10 space-y-3 p-6 text-white",children:[e.jsx("h3",{className:"text-xl font-semibold leading-snug md:text-2xl",children:a.title}),l&&e.jsx("p",{className:"line-clamp-2 text-sm leading-relaxed text-white/90",children:l}),e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-white/80",children:d})]})]},a.id)})}),i.hasNextPage&&e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>i.fetchNextPage(),disabled:i.isFetchingNextPage,className:"rounded-none bg-[color:var(--brand)] px-8 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white transition-colors hover:bg-[#a25a2c] disabled:cursor-not-allowed disabled:opacity-50",children:i.isFetchingNextPage?"Carregando...":"Carregar mais"})}),i.isFetchingNextPage&&e.jsx("div",{className:"mt-8 grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((a,t)=>e.jsx("div",{className:"h-[420px] animate-pulse rounded-none border border-white/10 bg-white/5"},`loading-more-${t}`))})]})]})})]})}export{T as component};
