import{a as p,B as h,u as y,s as n,j as e}from"./main-B5FlV0ud.js";import{u as j}from"./useMutation-DsfTo1KK.js";import{A as g,D as N}from"./AdminGuard-CcPwdLTL.js";import{S as f}from"./StatusBadge-wyWTkgTV.js";import"./x-DfPbw0Sj.js";import"./button-BmSOyNex.js";import"./search-BWiiaxVB.js";function F(){const{profile:r,session:i,signOut:c}=p(),l=r?.name??i?.user.email??"Admin",d=i?.user.email??"",o=h(),a=y({queryKey:["admin","orders"],queryFn:async()=>{const{data:s,error:t}=await n.from("orders").select("id, order_number, customer_name, customer_email, total, status, created_at").order("created_at",{ascending:!1}).limit(50);if(t)throw t;return s},staleTime:1e4}),m=j({mutationFn:async s=>{const{error:t}=await n.from("orders").update({status:s.status}).eq("id",s.id);if(t)throw t},onSuccess:()=>{o.invalidateQueries({queryKey:["admin","orders"]})}}),u=s=>new Intl.NumberFormat("pt-MZ",{style:"currency",currency:"MZN",maximumFractionDigits:0}).format(s),x=s=>{switch(s){case"paid":return"success";case"processing":return"info";case"failed":case"cancelled":return"danger";default:return"muted"}};return e.jsx(g,{children:e.jsx(N,{userRole:r?.role??"admin",userName:l,userEmail:d,onSignOut:c,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase text-gray-500",children:"Commerce"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Orders"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),"M-Pesa status feed will surface here."]})]}),e.jsx("div",{className:"rounded-2xl border border-gray-200 p-4 bg-white",children:a.isLoading?e.jsx("p",{className:"text-sm text-gray-500",children:"Loading ordersâ€¦"}):a.isError?e.jsx("p",{className:"text-sm text-rose-600",children:"Failed to load orders. Check connection or permissions."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-3",children:"Order"}),e.jsx("th",{className:"py-2 pr-3",children:"Customer"}),e.jsx("th",{className:"py-2 pr-3",children:"Total"}),e.jsx("th",{className:"py-2 pr-3",children:"Status"}),e.jsx("th",{className:"py-2 pr-3",children:"Created"}),e.jsx("th",{className:"py-2 pr-3",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:a.data?.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 pr-3 font-medium text-gray-900",children:s.order_number}),e.jsxs("td",{className:"py-3 pr-3 text-gray-700",children:[e.jsx("div",{children:s.customer_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.customer_email})]}),e.jsx("td",{className:"py-3 pr-3 text-gray-900",children:u(s.total)}),e.jsx("td",{className:"py-3 pr-3",children:e.jsx(f,{label:s.status,variant:x(s.status)})}),e.jsx("td",{className:"py-3 pr-3 text-gray-600",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"py-3 pr-3 text-sm",children:e.jsxs("select",{defaultValue:s.status,onChange:t=>m.mutate({id:s.id,status:t.target.value}),className:"rounded-lg border border-gray-300 px-2 py-1",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]},s.id))})]})})})]})})})}export{F as component};
