import{a as p,r as l,u as g,j as e,L as o,g as h,b,f as y,s as f}from"./main-B5FlV0ud.js";import{H as j}from"./Header-DLdij8DV.js";import"./x-DfPbw0Sj.js";function L(){const{session:d,profile:c}=p(),[i,m]=l.useState("all"),a=c?.email??d?.user?.email??null,s=g({queryKey:["my-orders",a],queryFn:async()=>{if(!a)return[];const{data:t,error:r}=await f.from("orders").select(`
          id,
          order_number,
          total,
          status,
          created_at,
          items:order_items(
            id,
            quantity,
            price,
            book:books(title, cover_url, cover_path)
          )
        `).eq("customer_email",a).order("created_at",{ascending:!1});if(r)throw r;return t??[]},enabled:!!a,staleTime:6e4}),n=l.useMemo(()=>{const t=s.data??[];return i==="all"?t:t.filter(r=>r.status===i)},[s.data,i]);return e.jsxs("div",{className:"min-h-screen bg-[#f8f4ef] text-gray-900",children:[e.jsx(j,{}),e.jsxs("main",{className:"container mx-auto px-4 py-16 lg:px-15",children:[e.jsx("h1",{className:"text-3xl font-semibold md:text-5xl",children:"Meus pedidos"}),!a&&e.jsxs("div",{className:"mt-8 border border-gray-200 bg-white p-8 text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"FaÃ§a login para ver os seus pedidos"}),e.jsx(o,{to:"/auth/sign-in",className:"mt-6 inline-flex items-center justify-center bg-[color:var(--brand)] px-6 py-2.5 text-sm font-semibold uppercase tracking-wider text-white hover:bg-[#a25a2c]",children:"Entrar"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-8 flex flex-wrap items-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",htmlFor:"order-status",children:"Filtrar status"}),e.jsxs("select",{id:"order-status",value:i,onChange:t=>m(t.target.value),className:"border border-gray-300 bg-white px-3 py-2 text-sm focus:border-[color:var(--brand)] focus:outline-none",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})]}),s.isLoading&&e.jsx("div",{className:"mt-6 space-y-4",children:Array.from({length:3}).map((t,r)=>e.jsx("div",{className:"h-24 animate-pulse border border-gray-200 bg-gray-100"},`orders-skeleton-${r}`))}),s.isError&&e.jsx("div",{className:"mt-6 border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Falha ao carregar pedidos. Tente novamente."}),!s.isLoading&&!s.isError&&n.length===0&&e.jsx("div",{className:"mt-6 border border-gray-200 bg-white p-6 text-sm text-gray-600",children:"Nenhum pedido encontrado."}),!s.isLoading&&!s.isError&&n.length>0&&e.jsx("div",{className:"mt-6 space-y-4",children:n.map(t=>{const r=h(t.status),x=b(t.status),u=new Date(t.created_at).toLocaleDateString("pt-PT",{day:"2-digit",month:"short",year:"numeric"});return e.jsxs("div",{className:"flex flex-col gap-4 border border-gray-200 bg-white p-5 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900",children:t.order_number}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold ${r}`,children:x})]}),e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:u}),e.jsx("p",{className:"text-sm text-gray-600",children:y(t.total)})]}),e.jsx(o,{to:`/pedido/${t.id}`,className:"inline-flex items-center justify-center border border-gray-300 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-wider text-gray-700 hover:border-gray-400",children:"Ver detalhes"})]},t.id)})})]})]})]})}export{L as component};
